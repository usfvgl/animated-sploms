function anisplom(G,w,i){var c={};var I={rows:0,cols:0,keep:0,indices:[],labels:[],colors:{},min:[],max:[],mid:[],drawn:false,table:undefined};var f;var q={color:undefined,grey:undefined,classes:{}};var B={x:undefined,y:undefined};var g={active:false,status:{}};var r=0;var y={framerate:30,point:{size:4.5,stroke:{thin:0.3,wide:0.8},alpha:125,color:["#8dd3c7","#fb8072","#80b1d3","#fdb462","#bc80bd","#b3de69","#fccde5","#d9d9d9","#ffffb3","#bebada"],},text:{normal:"rgb(169, 169, 169)",hover:"rgb(0, 0, 0)",sizes:{label:10,legend:12,}},grid:{width:125,pad:NaN,ticks:3,x:[],y:[],},plot:{x1:NaN,y1:NaN,x2:NaN,y2:NaN},legend:{x1:NaN,x2:NaN,size:NaN,keys:[]},progress:{top:{x:NaN,y:NaN,width:NaN,height:NaN},bar:{x:NaN,y:NaN,width:NaN,height:NaN},text:{x:NaN,y:NaN}},buttons:{play:{x:NaN,y:NaN,width:NaN,height:NaN},pause:{x:NaN,y:NaN,width:NaN,height:NaN},},canvas:{pad:35,width:NaN,height:NaN}};var C=function(K,N,M,L){if(L){L.stroke(255);L.strokeWeight(y.point.stroke.thin);L.fill(M);L.ellipse(K,N,y.point.size)}else{stroke(255);strokeWeight(y.point.stroke.thin);fill(M);ellipse(K,N,y.point.size)}};var b=function(K,P,O,L,N){var M=N?y.point.stroke.thin:y.point.stroke.wide;if(L){L.stroke(O);L.strokeWeight(M);L.noFill();L.ellipse(K,P,y.point.size)}else{stroke(O);strokeWeight(M);noFill();ellipse(K,P,y.point.size)}};var j={normal:C,open:b,alpha:function(K,O,N,L){var M=color(N);M=color(red(M),green(M),blue(M),y.point.alpha);push();blendMode(BLEND);C(K,O,M,L);pop()},blend:function(K,N,M,L){push();blendMode("darken");C(K,N,M,L);pop();b(K,N,"#FFFFFF",L,true)}};var a={};function d(){a.animate=F(i,"animate",true);a.prerender=F(i,"prerender",true);a.shuffle=F(i,"shuffle",false);a.rows=x(i,"rows",0,I.table.getRowCount(),1);a.scale=x(i,"scale",0,Number.MAX_SAFE_INTEGER,1);a.encoding=H(i,"encoding","normal");var K=getURLParams();a.animate=F(K,"animate",a.animate);a.prerender=F(K,"prerender",a.prerender);a.shuffle=F(K,"shuffle",a.shuffle);a.rows=x(K,"rows",0,I.table.getRowCount(),a.rows);a.scale=x(K,"scale",0,Number.MAX_SAFE_INTEGER,a.scale);a.encoding=H(K,"encoding",a.encoding);a.rows=Math.round(a.rows)}function F(K,M,N){if(K!=null&&K.hasOwnProperty(M)){if(typeof K[M]==="boolean"){return K[M]}if(typeof K[M]==="string"){var L=decodeURIComponent(K[M]).toLowerCase().trim();if(L==="true"||L==="false"){return L==="true"}}}console.assert(typeof N==="boolean");return N}function x(L,O,M,K,P){if(L!=null&&L.hasOwnProperty(O)){var N=L[O];if(typeof N==="string"){N=parseFloat(decodeURIComponent(N))}if(typeof N==="number"){if(N>M&&N<=K){return N}}}console.assert(P>M&&P<=K);return P}function H(K,M,N){if(K!=null&&K.hasOwnProperty(M)){var L=decodeURIComponent(K[M]).toLowerCase().trim();if(j.hasOwnProperty(L)){return L}}console.assert(j.hasOwnProperty(N));return N}function A(){shuffle(I.table.rows,true)}function k(K){if(abs(K)>=1000){return(K/1000).toFixed(1)+"k"}return K}function D(){h();z();J();n();u(0);o();t();E()}function h(){blendMode(REPLACE);rectMode(CORNER);noFill();strokeWeight(1);stroke(169,169,169);for(var L=0;L<I.keep-1;L++){for(var K=I.keep-1;K>L;K--){rect(y.grid.x[K],y.grid.y[L],y.grid.width,y.grid.width)}}}function z(){fill(169,169,169);for(var L=0;L<I.keep;L++){var N=I.keep-L-1;var P=[I.min[L],I.mid[L],I.max[L]];for(var M=0;M<P.length;M++){if(L!==0){var K=map(P[M],P[0],P[2],y.plot.x1+N*y.grid.width+y.grid.pad,y.plot.x1+(N+1)*y.grid.width-y.grid.pad);var O=y.plot.y1-y.grid.ticks;noStroke();textStyle(NORMAL);textAlign(CENTER,BOTTOM);textSize(y.text.sizes.label);text(k(P[M]),K,O);stroke(169,169,169);strokeWeight(1);line(K,y.plot.y1-y.grid.ticks,K,y.plot.y1)}if(L!==I.keep-1){var K=y.plot.x1-y.grid.ticks;var O=map(P[M],P[0],P[2],y.plot.y1+(L+1)*y.grid.width-y.grid.pad,y.plot.y1+L*y.grid.width+y.grid.pad);push();rotate(-HALF_PI);noStroke();textStyle(NORMAL);textAlign(CENTER,BOTTOM);textSize(y.text.sizes.label);text(k(P[M]),-O,K);pop();stroke(169,169,169);strokeWeight(1);line(y.plot.x1-y.grid.ticks,O,y.plot.x1,O)}}}}function J(){fill(169,169,169);for(var L=0;L<I.keep;L++){var M=I.keep-L-1;var O=[I.min[L],I.mid[L],I.max[L]];if(L!==0){var K=map(O[1],O[0],O[2],y.plot.x1+M*y.grid.width+y.grid.pad,y.plot.x1+(M+1)*y.grid.width-y.grid.pad);var N=y.plot.y1-y.grid.ticks;v(K,N,I.labels[L],false)}if(L!==I.keep-1){var K=y.plot.x1-y.grid.ticks;var N=map(O[1],O[0],O[2],y.plot.y1+(L+1)*y.grid.width-y.grid.pad,y.plot.y1+L*y.grid.width+y.grid.pad);v(K,N,I.labels[L],true)}}}function v(K,P,O,M){push();textStyle(BOLD);textAlign(CENTER,BOTTOM);textSize(y.text.sizes.label);if(M){rotate(-HALF_PI);var L=K;K=-P;P=L}fill(255);stroke(255);strokeWeight(1);text(O,K,P-textLeading());var N=M?B.y:B.x;if(N===O){fill(0)}else{fill(169)}noStroke();text(O,K,P-textLeading());pop()}function n(){textSize(y.text.sizes.legend);var L=y.plot.x2-y.grid.width;var S=y.plot.y2-y.grid.width;var R=w.columns.names[w.classes.index];fill(255);stroke(169,169,169);strokeWeight(1);rectMode(CORNER);rect(L,S,y.grid.width,y.grid.width);noStroke();textStyle(BOLD);textAlign(CENTER,TOP);fill(169,169,169);text(R,L+0.5*y.grid.width,S+y.grid.pad);var M=round(4*a.scale);var Q=round((y.grid.width-textLeading()-y.grid.pad*2)/w.classes.names.length);var U=Q-M;var T=U/2;y.legend.x1=L+y.grid.pad;y.legend.x2=L+y.grid.pad+U;y.legend.size=U;y.legend.pad=M;for(var N=0;N<w.classes.names.length;N++){var P=L+y.grid.pad;var O=S+y.grid.pad+textLeading()+M+Q*N;var K=w.classes.names[N];y.legend.keys.push({y1:O,y2:O+U,index:N,name:K});p(P,O,K)}}function p(L,P,N){textSize(y.text.sizes.legend);textAlign(LEFT,CENTER);textStyle(NORMAL);rectMode(CORNER);var M=L+y.legend.size+y.legend.pad;var K=P+y.legend.size/2;fill(255);stroke(255);strokeWeight(1);text(N,M,K);rect(L,P,y.legend.size,y.legend.size);var O=g.status[N]?"#D9D9D9":I.colors[N];noStroke();fill(O);rect(L,P,y.legend.size,y.legend.size);text(N,M,K)}function u(N){var M=round(N/I.rows*100);var K=I.drawn?"% of rows animated":"% of rows displayed";strokeWeight(1);stroke(255);fill(255);rect(y.progress.top.x,y.progress.top.y,y.progress.top.width,y.progress.top.height);var L=map(N,0,I.rows,0,y.progress.bar.width);if(I.drawn){fill(169);stroke(255);rect(y.progress.bar.x,y.progress.bar.y,y.progress.bar.width,y.progress.bar.height);stroke(255);line(y.progress.bar.x+L,y.progress.bar.y,y.progress.bar.x+L,y.progress.bar.y+y.progress.bar.height)}else{fill(169);stroke(169);rect(y.progress.bar.x,y.progress.bar.y,L,y.progress.bar.height);noFill();rect(y.progress.bar.x,y.progress.bar.y,y.progress.bar.width,y.progress.bar.height)}fill(169);noStroke();textSize(y.text.sizes.label);textAlign(RIGHT,BOTTOM);text(M+K,y.progress.text.x,y.progress.text.y)}function o(){var L=a.animate?169:217;var K=a.animate?217:169;noStroke();fill(L);triangle(y.buttons.play.x,y.buttons.play.y,y.buttons.play.x+y.buttons.play.width,y.buttons.play.y+y.buttons.play.height/2,y.buttons.play.x,y.buttons.play.y+y.buttons.play.height);fill(K);rect(y.buttons.pause.x,y.buttons.pause.y,y.buttons.pause.width*0.4,y.buttons.pause.height);rect(y.buttons.pause.x+y.buttons.pause.width-y.buttons.pause.width*0.4,y.buttons.pause.y,y.buttons.pause.width*0.4,y.buttons.pause.height)}function t(){var K=createInput(a.rows,"number");K.attribute("id","rows");K.attribute("min",1);K.attribute("max",I.rows);K.attribute("step",1);K.parent(G);K.style("width",(y.buttons.play.x-y.progress.top.x-y.buttons.pause.width*0.4)+"px");K.style("text-align","right");K.style("font-size",y.text.sizes.legend+"px");K.input(function(){a.rows=parseInt(K.value())});windowResized()}function E(){textSize(y.text.sizes.label);fill(160);noStroke();textAlign(LEFT,BOTTOM);text("Rows per frame ("+I.rows+" max)",y.progress.top.x,y.buttons.play.y-4*a.scale)}function m(M){var K=I.table.getString(M,w.classes.index);var O=I.colors[K];for(var S=0;S<I.keep-1;S++){var R=I.table.getNum(M,I.indices[S]);var P=map(R,I.min[S],I.max[S],y.grid.y[S]+y.grid.width-y.grid.pad,y.grid.y[S]+y.grid.pad);for(var L=I.keep-1;L>S;L--){var N=I.table.getNum(M,I.indices[L]);var Q=map(N,I.min[L],I.max[L],y.grid.x[L]+y.grid.pad,y.grid.x[L]+y.grid.width-y.grid.pad);j[a.encoding](Q,P,O,q.color);j[a.encoding](Q,P,O,q.classes[K]);j[a.encoding](Q,P,"#D9D9D9",q.grey);if(g.active&&g.status[K]){j[a.encoding](Q,P,"#D9D9D9",undefined)}else{j[a.encoding](Q,P,O,undefined)}}}}function l(){if(g.active){image(q.grey,0,0,y.canvas.width,y.canvas.height);for(var K in g.status){if(!g.status[K]){image(q.classes[K],0,0,y.canvas.width,y.canvas.height)}}}else{image(q.color,0,0,y.canvas.width,y.canvas.height)}}function e(N){var L=document.getElementById(G);var O=document.createElement("div");L.insertBefore(O,L.firstChild);O.id="alert";O.classList.add("columns");O.classList.add("is-centered");var K=document.createElement("div");O.appendChild(K);K.classList.add("column");K.classList.add("is-narrow");var M=document.createElement("div");K.appendChild(M);M.classList.add("notification");M.innerHTML='<p><i class="fa fa-pulse fa-spinner"></i> '+N+"</p>"}function s(){noLoop();for(var K=0;K<I.rows;K++){m(K)}a.prerender=false;I.drawn=true;if(a.animate){loop()}}c.preload=function(){I.table=loadTable(w.path,"csv","header")};c.setup=function(){I.rows=I.table.getRowCount();I.cols=I.table.getColumnCount();I.keep=w.columns.shown.length;console.log("Loaded "+I.rows+" rows and "+I.cols+' columns from "'+w.path+'".');for(var O=0;O<I.keep;O++){var M=w.columns.shown[O];var K=I.table.getColumn(M);I.indices[O]=M;I.labels[O]=w.columns.names[M];I.min[O]=floor(min(K));I.max[O]=ceil(max(K));I.mid[O]=I.min[O]+(I.max[O]-I.min[O])/2}d();if(a.shuffle){A()}if(a.scale!==1){y.point.size*=a.scale;y.point.stroke.thin*=a.scale;y.point.stroke.wide*=a.scale;for(var N in y.text.sizes){y.text.sizes[N]*=a.scale}y.grid.width*=a.scale;y.grid.ticks*=a.scale;y.canvas.pad*=a.scale}y.canvas.width=y.grid.width*(I.keep-1)+2*y.canvas.pad;y.canvas.height=y.canvas.width;q.color=createGraphics(y.canvas.width,y.canvas.height);q.grey=createGraphics(y.canvas.width,y.canvas.height);q.classes={};q.color.pixelDensity(pixelDensity());q.grey.pixelDensity(pixelDensity());for(var O=0;O<w.classes.names.length;O++){var L=String(w.classes.names[O]);I.colors[L]=y.point.color[O];q.classes[L]=createGraphics(y.canvas.width,y.canvas.height);g.status[L]=false;q.classes[L].pixelDensity(pixelDensity())}y.grid.pad=y.grid.width*0.1;y.grid.x.push(undefined);for(var O=0;O<I.keep-1;O++){y.grid.x.push(y.canvas.width-y.canvas.pad-y.grid.width-O*y.grid.width);y.grid.y.push(y.canvas.pad+O*y.grid.width)}y.grid.y.push(undefined);y.plot.x1=y.canvas.pad;y.plot.x2=y.canvas.width-y.canvas.pad;y.plot.y1=y.canvas.pad;y.plot.y2=y.canvas.height-y.canvas.pad;y.progress.bar.width=y.grid.width;y.progress.bar.height=y.grid.pad*1.5;y.progress.bar.x=y.plot.x2-y.grid.width;y.progress.bar.y=y.plot.y2-y.grid.width-y.grid.pad-y.progress.bar.height;y.progress.text.x=y.plot.x2-1;y.progress.text.y=y.progress.bar.y-1;textSize(y.text.sizes.label);y.progress.top.x=y.progress.bar.x+1;y.progress.top.y=y.progress.text.y-textLeading();y.progress.top.width=y.progress.bar.width;y.progress.top.height=y.plot.y2-y.grid.width-y.grid.pad-y.progress.top.y;y.buttons.play.width=y.progress.bar.height*0.8;y.buttons.play.height=y.progress.bar.height;y.buttons.pause.width=y.buttons.play.width;y.buttons.pause.height=y.buttons.play.height;y.buttons.pause.x=y.plot.x2-y.buttons.pause.width;y.buttons.pause.y=y.progress.top.y-y.buttons.pause.height-y.grid.pad;y.buttons.play.x=y.buttons.pause.x-y.buttons.play.width-y.buttons.pause.width*0.2;y.buttons.play.y=y.buttons.pause.y;f=createCanvas(y.canvas.width,y.canvas.height);f.parent(G);background(255);frameRate(y.framerate);cursor(ARROW);blendMode(REPLACE);D();if(!a.animate){a.prerender=true}console.log("Setup complete!",y,a,I)};c.draw=function(){if(frameCount===1){windowResized()}if(a.prerender){if(frameCount==1){e("Prerendering "+I.rows+" rows and "+I.keep+" columns...")}else{if(frameCount>1){s();u(I.rows);var L=select("#alert");if(L!=null){L.remove()}}}}else{if(y.canvas==null||a.animate==null){return}var K=0;while(K<a.rows){m(r);if(r===I.rows-1){I.drawn=true;if(a.shuffle){A()}}r=(r+1)%I.rows;K++}u(r)}};c.mouseClicked=function(){if(mouseX>=y.legend.x1&&mouseX<=y.legend.x2){for(var M=0;M<y.legend.keys.length;M++){var L=y.legend.keys[M];if(mouseY<L.y1){break}if(mouseY>L.y2){continue}g.status[L.name]=!g.status[L.name];p(y.legend.x1,L.y1,L.name);var N=Object.values(g.status).every(function(O){return O===false});if(N){g.active=false}else{if(g.status[L.name]){g.active=true}}if(!g.active){image(q.color,0,0,y.canvas.width,y.canvas.height)}else{if(!g.status[L.name]){image(q.classes[L.name],0,0,y.canvas.width,y.canvas.height)}else{image(q.grey,0,0,y.canvas.width,y.canvas.height);for(var K in g.status){if(!g.status[K]){image(q.classes[K],0,0,y.canvas.width,y.canvas.height)}}}}break}}if(mouseY>=y.buttons.play.y&&mouseY<=y.buttons.play.y+y.buttons.play.height){if(mouseX>=y.buttons.play.x&&mouseX<=y.buttons.play.x+y.buttons.play.width){if(!a.animate){a.animate=true;o();loop()}}else{if(mouseX>=y.buttons.pause.x&&mouseX<=y.buttons.pause.x+y.buttons.pause.width){if(a.animate){a.animate=false;o();noLoop()}}}}};c.mouseMoved=function(){var K={x:B.x,y:B.y};if(mouseX>=y.plot.x1&&mouseX<y.plot.x2&&mouseY>=y.plot.y1&&mouseY<y.plot.y2){var M=I.keep-Math.floor((mouseX-y.plot.x1)/y.grid.width)-1;console.assert(M>0&&M<I.keep);B.x=I.labels[M];var L=Math.floor((mouseY-y.plot.y1)/y.grid.width);console.assert(L>=0&&L<I.keep-1);B.y=I.labels[L]}else{B.x=undefined;B.y=undefined}if(K.x!==B.x||K.y!==B.y){J()}};c.windowResized=function(){var K=select("#rows");if(K){K.position(f.position().x+y.progress.top.x,f.position().y+y.buttons.play.y)}};return c};