<script language="javascript" type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/p5.js/0.4.19/p5.js"></script>
<script language="javascript" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.4/addons/p5.dom.js"></script>
<script language="javascript" type="text/javascript" src="../multi_scatter.js"></script>
<style>
body {
  font-family: sans-serif;
  font-size: 11pt;
  background-color: whitesmoke;
  text-align: center;
}

th {
  min-width: 5em;
  font-size: 8pt;
}

td {
  text-align: center;
  font-size: 10pt;
}
</style>

<div id="chart" align="center"></div>

<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>

<table align="center" border="1" cellspacing="0" padding="2">
<thead>
  <tr>
    <th colspan="3">Points</th>
    <th colspan="3">Variable 1</th>
    <th colspan="3">Variable 2</th>
  </tr>
  <tr>
    <th>Class</th>
    <th>Total</th>
    <th>Best</th>
    <th>Name</th>
    <th>Min</th>
    <th>Max</th>
    <th>Name</th>
    <th>Min</th>
    <th>Max</th>
  </tr>
</thead>
<tbody>
  <tr id="debug">
  </tr>
</tbody>
</table>

<script language="javascript" type="text/javascript">
  var search = window.location.search ? window.location.search.slice(1) : "data00&true";
  var params = search.split('&');

  var data = params.length === 2 ? params[0] : 'data00';
  var toanimate = params.length === 2 && params[1] === "true" ? true : false;

  var attr = {
		all: ["v", "w", "x", "y", "z", "class"],
		use: [0, 1, 2, 3, 4]
	};

	var category = {
		name: "class",
		index: 5,
		values: ["A", "B", "C", "D", "E"]
	};

	var animate = {
		isAnimate: toanimate,
		initDraw: true,
		animateNum: 10
	};

	var chart = multi_scatter(data + '.csv', attr, category, animate, "filled_normal", data, null, "true", "chart");

  var maxNum = 0;

  var cells = ["n_class", "n_cur", "n_max", "x_var", "x_min", "x_max", "y_var", "y_min", "y_max"];
  var row = document.getElementById("debug");
  var td = {};

  cells.forEach(function(d, i) {
    td[d] = row.insertCell(-1);
    td[d].innerHTML = "&nbsp;";
  });

	function preload() {
    chart.preload();
  }

  function draw() { chart.draw(); }

	function setup() {
		chart.setup();
	}

	function mousePressed() {
		chart.mousePressed();
		return false;
	}

	function mouseReleased() {
		var timestamp = Date.now();

		if(chart.mouseReleased()) {
      var count = chart.getNumPointsInRect();
      var sum = Object.values(count).reduce(function(a, b) { return a + b; }, 0);

      maxNum = sum > maxNum ? sum : maxNum;

      td.n_class.innerHTML = Object.keys(count).length;
      td.n_cur.innerHTML = sum;
      td.n_max.innerHTML = maxNum;
      td.x_var.innerHTML = chart.highlightRect.xAttr;
      td.x_min.innerHTML = chart.highlightRect.xLow.toFixed(2);
      td.x_max.innerHTML = chart.highlightRect.xHigh.toFixed(2);
      td.y_var.innerHTML = chart.highlightRect.yAttr;
      td.y_min.innerHTML = chart.highlightRect.yLow.toFixed(2);
      td.y_max.innerHTML = chart.highlightRect.yHigh.toFixed(2);
		}

		return false;
	}

	function mouseMoved() {
		chart.mouseMoved();
		return false;
	}

	function mouseDragged() {
		chart.mouseDragged();
		return false;
	}
</script>
