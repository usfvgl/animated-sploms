<script language="javascript" type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/p5.js/0.4.19/p5.js"></script>
<!-- uncomment lines below to include extra p5 libraries -->
<script language="javascript" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.4/addons/p5.dom.js"></script>
<!--<script language="javascript" src="libraries/p5.sound.js"></script>-->
<script language="javascript" type="text/javascript" src="../multi_scatter.js"></script>
<!-- this line removes any default padding and style. you might only need one of these values set. -->
<style> body {padding: 0; margin: 0;} </style>
<!-- TODO update div id to match module name-->
<div id="splom_template">
	<div id="question"></div>
	<div id="chart" style="float: left;"></div>
	<div><img width="575" id="static" style="margin-top: 50px;"></div>
</div>

<script language="javascript" type="text/javascript">
	// i'm lazy deal with it
	var dataName = window.location.pathname.split('/').pop().split('.')[0];

	document.getElementById("static").src=dataName + ".png";

	var dataSource = dataName + ".csv";
	var attr = {
		all: ["v", "w", "x", "y", "z", "class"],
		use: [0, 1, 2, 3, 4]
	};
	var category = {
		name: "class",
		index: 5,
		values: ["A", "B", "C", "D", "E"]
	};

	var chartTitle = "";
	var animate = {
			isAnimate: true,
			initDraw: true,
			animateNum: 8
		};

	var tag = "blobs";

	var storeInfo = {};
	storeInfo[tag + '_question'] = "Drag the box to select the region for variables <var>x</var> and <var>y</var> with the most points.";
	// Encoding technique used for plotting points. technique needs to be one of the following Strings:
	// filled_normal:  filled cirlces without color blending (default)
	// filled_blended: filled circles with color blending
	// alpha_blended:  filled circles with alpha blending
	// open:           unfilled circles with color outline
	storeInfo[tag + '_technique'] = 'filled_normal';
	storeInfo[tag + '_animate'] = animate.isAnimate;
	storeInfo[tag + '_dataset'] = dataSource;
	document.getElementById('question').innerHTML = storeInfo[tag + '_question'];

	// p5 object and functions
	var chart = multi_scatter(dataSource, attr, category, animate, storeInfo[tag + '_technique'], chartTitle, null, "true", "chart");

	function preload() {
		chart.preload();
	}

	function setup() {
		chart.setup();
	}

	function draw() {
		chart.draw();
	}

	function mousePressed() {
		chart.mousePressed();
		// prevent default: see p5 documentation
		return false;
	}

	function mouseReleased() {

		var timestamp = Date.now();

		// Only log time and highlightRect information when user released mouse
		// after previously clicking on it. See multi_scatter.mouseReleased()
		if(chart.mouseReleased()) {
			storeInfo[tag + '_rectXValue'] = chart.highlightRect.x;
			storeInfo[tag + '_rectYValue'] = chart.highlightRect.y;
			storeInfo[tag + '_rectXAttr'] = chart.highlightRect.xAttr;
			storeInfo[tag + '_rectYAttr'] = chart.highlightRect.yAttr;
			if(storeInfo[tag + '_firstSelectTime'] === undefined) {
				storeInfo[tag + '_firstSelectTime'] = timestamp;
				//experimentr.release();
			} else {
				storeInfo[tag + '_lastSelectTime'] = timestamp;
			}

			console.log(chart.highlightRect.x, chart.highlightRect.y);
		}

		// prevent default: see p5 documentation
		return false;
	}

	function mouseMoved() {
		chart.mouseMoved();
		// prevent default: see p5 documentation
		return false;
	}

	function mouseDragged() {
		chart.mouseDragged();
		// prevent default: see http://p5js.org/reference/#/p5/mouseDragged
		return false;
	}

	function printDebugInfo() {
		console.log(storeInfo);
	}

</script>
